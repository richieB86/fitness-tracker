<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fitness Tracker</title>
    <meta name="theme-color" content="#3b82f6">
    <link rel="manifest" href="manifest.json">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React -->
    <script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    
    <!-- Babel für JSX -->
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    
    <!-- Recharts für die Diagramme -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.1.12/Recharts.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Destructure benötigte React Hooks
        const { useState, useEffect } = React;
        const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Legend } = Recharts;

        function FitnessTracker() {
            const [currentView, setCurrentView] = useState('newWorkout');
            const [exercises, setExercises] = useState(() => {
                const saved = localStorage.getItem('exercises');
                return saved ? JSON.parse(saved) : [];
            });
            
            const [workouts, setWorkouts] = useState(() => {
                const saved = localStorage.getItem('workouts');
                return saved ? JSON.parse(saved) : [];
            });
            
            const [newExercise, setNewExercise] = useState('');
            const [exerciseError, setExerciseError] = useState('');
            const [selectedExercise, setSelectedExercise] = useState('');
            const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0]);
            const [sets, setSets] = useState([{ reps: '', weight: '' }]);
            
            useEffect(() => {
                localStorage.setItem('exercises', JSON.stringify(exercises));
                localStorage.setItem('workouts', JSON.stringify(workouts));
            }, [exercises, workouts]);

            const handleAddExercise = () => {
                const trimmedExercise = newExercise.trim();
                if (trimmedExercise) {
                    if (exercises.includes(trimmedExercise)) {
                        setExerciseError('Diese Übung existiert bereits!');
                        return;
                    }
                    setExercises([...exercises, trimmedExercise]);
                    setNewExercise('');
                    setExerciseError('');
                }
            };

            const handleAddSet = () => {
                setSets([...sets, { reps: '', weight: '' }]);
            };

            const handleSetChange = (index, field, value) => {
                const newSets = [...sets];
                newSets[index][field] = value;
                setSets(newSets);
            };

            const handleSaveWorkout = () => {
                if (selectedExercise && sets.some(set => set.reps && set.weight)) {
                    const totalWeight = sets.reduce((sum, set) => {
                        return sum + (Number(set.reps) * Number(set.weight) || 0);
                    }, 0);

                    const workout = {
                        date: selectedDate,
                        exercise: selectedExercise,
                        sets: sets,
                        totalWeight
                    };

                    setWorkouts([...workouts, workout]);
                    setSelectedExercise('');
                    setSets([{ reps: '', weight: '' }]);
                }
            };

            const getChartData = () => {
                return workouts
                    .sort((a, b) => new Date(a.date) - new Date(b.date))
                    .map(workout => ({
                        date: workout.date,
                        totalWeight: workout.totalWeight
                    }));
            };

            // Mobile-freundliche Navigation
            const Navigation = () => (
                <div className="fixed bottom-0 left-0 right-0 bg-white border-t flex justify-around p-4 space-x-2">
                    <button
                        onClick={() => setCurrentView('newExercise')}
                        className={`flex-1 p-2 rounded ${
                            currentView === 'newExercise' ? 'bg-blue-500 text-white' : 'bg-gray-100'
                        }`}
                    >
                        Übungen
                    </button>
                    <button
                        onClick={() => setCurrentView('newWorkout')}
                        className={`flex-1 p-2 rounded ${
                            currentView === 'newWorkout' ? 'bg-blue-500 text-white' : 'bg-gray-100'
                        }`}
                    >
                        Training
                    </button>
                    <button
                        onClick={() => setCurrentView('progress')}
                        className={`flex-1 p-2 rounded ${
                            currentView === 'progress' ? 'bg-blue-500 text-white' : 'bg-gray-100'
                        }`}
                    >
                        Fortschritt
                    </button>
                </div>
            );

            const renderView = () => {
                switch (currentView) {
                    case 'newExercise':
                        return (
                            <div className="p-4 space-y-4">
                                <h2 className="text-xl font-bold">Neue Übung</h2>
                                <div className="space-y-4">
                                    <input
                                        type="text"
                                        value={newExercise}
                                        onChange={(e) => {
                                            setNewExercise(e.target.value);
                                            setExerciseError('');
                                        }}
                                        placeholder="Neue Übung eingeben"
                                        className="w-full p-2 border rounded"
                                    />
                                    {exerciseError && (
                                        <div className="text-red-500">{exerciseError}</div>
                                    )}
                                    <button
                                        onClick={handleAddExercise}
                                        className="w-full p-2 bg-blue-500 text-white rounded"
                                    >
                                        Übung hinzufügen
                                    </button>
                                    
                                    <div className="mt-6">
                                        <h3 className="font-bold mb-2">Gespeicherte Übungen:</h3>
                                        <ul className="list-disc pl-4">
                                            {exercises.map((exercise, index) => (
                                                <li key={index}>{exercise}</li>
                                            ))}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        );

                    case 'newWorkout':
                        return (
                            <div className="p-4 space-y-4">
                                <h2 className="text-xl font-bold">Neues Training</h2>
                                <input
                                    type="date"
                                    value={selectedDate}
                                    onChange={(e) => setSelectedDate(e.target.value)}
                                    className="w-full p-2 border rounded"
                                />
                                <select
                                    value={selectedExercise}
                                    onChange={(e) => setSelectedExercise(e.target.value)}
                                    className="w-full p-2 border rounded"
                                >
                                    <option value="">Übung auswählen</option>
                                    {exercises.map((exercise, index) => (
                                        <option key={index} value={exercise}>
                                            {exercise}
                                        </option>
                                    ))}
                                </select>

                                {sets.map((set, index) => (
                                    <div key={index} className="flex gap-2">
                                        <input
                                            type="number"
                                            value={set.reps}
                                            onChange={(e) => handleSetChange(index, 'reps', e.target.value)}
                                            placeholder="Wiederholungen"
                                            className="flex-1 p-2 border rounded"
                                        />
                                        <input
                                            type="number"
                                            value={set.weight}
                                            onChange={(e) => handleSetChange(index, 'weight', e.target.value)}
                                            placeholder="Gewicht (kg)"
                                            className="flex-1 p-2 border rounded"
                                        />
                                    </div>
                                ))}

                                <div className="flex gap-2">
                                    <button
                                        onClick={handleAddSet}
                                        className="p-2 bg-gray-500 text-white rounded flex-none"
                                    >
                                        + Satz
                                    </button>
                                    <button
                                        onClick={handleSaveWorkout}
                                        className="flex-1 p-2 bg-blue-500 text-white rounded"
                                    >
                                        Training speichern
                                    </button>
                                </div>
                            </div>
                        );

                    case 'progress':
                        return (
                            <div className="p-4">
                                <h2 className="text-xl font-bold mb-4">Fortschritt</h2>
                                <div className="h-64">
                                    <ResponsiveContainer width="100%" height="100%">
                                        <LineChart data={getChartData()}>
                                            <CartesianGrid strokeDasharray="3 3" />
                                            <XAxis dataKey="date" />
                                            <YAxis />
                                            <Tooltip />
                                            <Legend />
                                            <Line
                                                type="monotone"
                                                dataKey="totalWeight"
                                                name="Gesamtgewicht (kg)"
                                                stroke="#3b82f6"
                                                dot={{ r: 4 }}
                                            />
                                        </LineChart>
                                    </ResponsiveContainer>
                                </div>
                            </div>
                        );
                }
            };

            return (
                <div className="pb-20"> {/* Padding unten für die Navigation */}
                    {renderView()}
                    <Navigation />
                </div>
            );
        }

        // App rendern
        ReactDOM.render(<FitnessTracker />, document.getElementById('root'));
    </script>
    
    <script>
        // Service Worker registrieren
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('ServiceWorker registered');
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }
    </script>
</body>
</html>
